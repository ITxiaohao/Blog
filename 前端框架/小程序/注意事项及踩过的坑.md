---
title: "æ³¨æ„äº‹é¡¹åŠè¸©è¿‡çš„å‘"
permalink: "miniprogram-note"
---

## button ç»„ä»¶

#### é»˜è®¤æ ·å¼æ›´æ”¹åŠç‚¹å‡»æ ·å¼æ›´æ”¹

æŒ‰é’®çš„é»˜è®¤æ ·å¼ä¼šæœ‰è¾¹æ¡†ï¼Œå¦‚æœé¡¹ç›®ä¸­ä¸éœ€è¦é»˜è®¤è¾¹æ¡†ï¼Œå¯ä»¥åœ¨å…¨å±€æ ·å¼ app.wxss ä¸­åŠ ä¸Šï¼Œä¹Ÿå¯ä»¥å±€éƒ¨è®¾ç½®

```css
/* å…¨å±€ button */
button::after {
  border: 0;
}

/* å±€éƒ¨ */
.test button::after {
  border: 0;
}
```

é€šè¿‡**å±æ€§é€‰æ‹©å™¨**æ¥è‡ªå®šä¹‰ç¦ç”¨åçš„æ ·å¼

```css
.other[disabled] {
  background: linear-gradient(
    to right,
    rgba(16, 103, 233, 0.8),
    rgba(16, 142, 233, 0.6)
  );
  box-shadow: 0 1rpx 6rpx 2rpx rgba(16, 103, 233, 0.7);
  color: rgba(0, 0, 0, 0.2);
}
```

---

#### è‡ªå®šä¹‰æŒ‰é’®ç‚¹å‡»æ—¶çš„æ ·å¼

::: warning æ³¨æ„ï¼
å¦‚æœè®¾ç½®äº†æŒ‰é’®çš„ type å±æ€§ï¼Œå¦‚ `type="primary"` ,åˆ™æ— æ³•è‡ªå®šä¹‰æˆåŠŸï¼Œå¿…é¡»åˆ é™¤ `type` å±æ€§ï¼Œ`hover-class` çš„ç±»åé»˜è®¤å€¼ä¸º `button-hover`
:::

```html
<!-- è‡ªå®šä¹‰ç‚¹å‡»æ ·å¼ç±» -->
<button hover-class="other-button-hover">primary</button>
```

```css
/** ä¿®æ”¹ button é»˜è®¤çš„ç‚¹å‡»æ€æ ·å¼ç±»**/
.button-hover {
  background-color: red;
}

/** æ·»åŠ è‡ªå®šä¹‰ button ç‚¹å‡»æ€æ ·å¼ç±»**/
.other-button-hover {
  background-color: blue;
}
```

## wx.switchTab æ³¨æ„äº‹é¡¹

:::tip
wx.switchTab: url ä¸æ”¯æŒ `queryString`ï¼Œä¹Ÿå°±æ˜¯æ— æ³•é€šè¿‡ `url + ? + å‚æ•°` çš„å½¢å¼æ¥ä¼ é€’å‚æ•°
:::

1. é€šè¿‡**å…¨å±€å˜é‡**çš„æ–¹å¼å­˜å‚¨æ•°æ®
2. é€šè¿‡**ç¼“å­˜**æ¥å­˜å‚¨

å¦‚æœä¸æ˜¯å¸¸ç”¨çš„æ•°æ®ï¼Œæ— éœ€é€šè¿‡ç¼“å­˜ï¼Œç›´æ¥ç”¨å…¨å±€å˜é‡çš„æ–¹å¼å­˜å‚¨å°±å¯ä»¥äº†

åœ¨æœ€å¤–å±‚çš„ `app.js` æ–‡ä»¶ä¸­å®šä¹‰ **å…¨å±€å˜é‡**

```js {3}
App({
  onLaunch: function() {},
  globalData: {
    userInfo: null
  }
});
```

åœ¨é¡µé¢ä¸­å¼•å…¥å¹¶ä½¿ç”¨å…¨å±€å˜é‡

```js {1}
var app = getApp(); // å¼•å…¥å…¨å±€ App
Page({
  // ä½¿ç”¨
  onLoad: function(options) {
    console.log(app.globalData.userInfo); // è¾“å‡ºå…¨å±€å˜é‡ä¸­çš„å€¼
  }
});
```

åœ¨ `wx.switchTab` çš„ `success` å›è°ƒå‡½æ•°ä¸­ï¼Œè¦æ‰§è¡Œä¸€æ¬¡åˆ·æ–°æ“ä½œï¼Œ`page.onLoad()` ä¸ç„¶æ‹¿ä¸åˆ°å€¼

```js {6}
wx.switchTab({
  url: "../home/index",
  success: function() {
    var page = getCurrentPages().pop();
    if (page == undefined || page == null) return;
    page.onLoad();
  }
});
```

## web-view ç»„ä»¶çš„å‘

åœ¨å°ç¨‹åºä¸­å¯ä»¥é€šè¿‡ `web-view` æ ‡ç­¾å¯ä»¥è·³è½¬åˆ° `H5` é¡µé¢

::: warning æ³¨æ„ï¼
`web-view` ä¸èƒ½åœ¨ä¸ªäººç”³è¯·çš„å°ç¨‹åºä¸­ä½¿ç”¨ï¼Œå¿…é¡»æ˜¯å…¬å¸ä¸»ä½“ç”³è¯·çš„å°ç¨‹åº

å…¬ä¼—å·çš„ `openId` å’Œå°ç¨‹åºçš„ `openId` æ˜¯ **ä¸ä¸€æ ·** çš„ï¼Œè¦åœ¨ **å¾®ä¿¡å¼€æ”¾å¹³å°** ç»‘å®šå…¬ä¼—å·å’Œå°ç¨‹åºä»¥åï¼Œæ ¹æ® `openId` å»è·å–çš„ `unionid` æ˜¯ä¸€è‡´çš„
:::

::: danger æŠ¥é”™ï¼
å¦‚æœæŠ¥é”™ä¿¡æ¯ä¸ºï¼šä¸æ”¯æŒæ‰“å¼€éä¸šåŠ¡åŸŸå `www.xxx.com` è¯·é‡æ–°é…ç½®çš„è§£å†³æ–¹æ¡ˆï¼š
:::

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­å¯ä»¥æŸ¥çœ‹æ˜¯å¦æœ‰é…ç½® `web-view` çš„ä¸šåŠ¡åŸŸå

![](https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/vue-admin/20190716225641.png)

---

#### åŸŸåé…ç½®åŠæ ¡éªŒ

åœ¨å°ç¨‹åºä¸­é…ç½®ä¸šåŠ¡åŸŸå

<!-- ![](./image/wx/web-view-addDomain.png) -->

![](https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/wx/webView-addDomain.png)

ä¸‹è½½å®˜æ–¹æä¾›çš„æ ¡éªŒæ–‡ä»¶

![](https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/wx/web-view-setDomain.png)

<!-- ![](./image/wx/web-view-setDomain.png) -->

å°†ä¸‹è½½çš„æ–‡ä»¶æ”¾åˆ°æœåŠ¡å™¨ä¸­ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨ `nginx`

æ–°å»º `check/miniprogram` æ–‡ä»¶å¤¹ï¼Œå°†ä¸‹è½½çš„æ–‡ä»¶æ”¾è¿›å»

![](https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/vue-admin/20190716225759.png)

è®¾ç½® `nginx.conf` æ–‡ä»¶

```xml
server{
	listen 80;
	server_name www.xxx.com; #ä½ çš„åŸŸå

	#miniprogram
	location /UCP0jRyqei.txt { #æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„
    root   check/miniprogram;  #æ–‡ä»¶å¤¹çš„è·¯å¾„
    index  index.html index.htm;
  }
}
```

é…ç½®æˆåŠŸåï¼Œè®¿é—® `http://www.xxxx.com/xxxx.txt` ï¼Œä½ çš„åŸŸå + æ–‡ä»¶åï¼Œå¦‚æœæœ‰æˆåŠŸè¿”å›ï¼Œè¯´æ˜é…ç½®æˆåŠŸ

å†å»å°ç¨‹åºçš„ä¸šåŠ¡åŸŸåé‡Œä¿å­˜åŸŸåï¼Œå³å¯åœ¨å°ç¨‹åºä¸­é€šè¿‡ `web-view` å»è®¿é—®ç½‘é¡µ ğŸ˜

---

#### web-view è·³è½¬å…¬ä¼—å·æˆæƒç½‘é¡µ

ç›®å‰å…¬å¸ä¸šåŠ¡éœ€è¦åœ¨å°ç¨‹åºä¸­é€šè¿‡ `web-view` å»ç½‘é¡µä¸­æˆæƒå…¬ä¼—å·

æ‰€ä»¥è¿™ä¸ª H5 é¡µé¢å°±æ˜¯ç”¨æˆ·è·å– `code`ï¼Œæ‹¿åˆ° `code` ç»™æœåŠ¡ç«¯ï¼Œä»è€Œè·å–ç”¨æˆ·çš„å…¬ä¼—å· `openId`

```html
<web-view
  wx:if="{{authorize}}"
  bindmessage="msgHandler"
  src="https://open.weixin.qq.com/connect/oauth2/authorize?appid=XXX&redirect_uri=https://www.XXX.com/GZHLogin.html&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"
></web-view>
```

ä»¥ä¸Šä»£ç æ®µä¸­çš„ `appid` å’Œ `https` çš„åœ°å€éœ€è¦æ›¿æ¢

åœ¨ **H5** é¡µé¢ä¸­å¾€å°ç¨‹åºå‘é€æ•°æ®ï¼Œä½¿ç”¨ `postMessage` æ¥å£

```js
wx.miniProgram.postMessage({ data: { gzhOpenId: res.data.openId } });
```

åœ¨ `web-view` ä¸­è®¾ç½®å±æ€§ `bindmessage` æ¥æ¥å—ç½‘é¡µè¿”å›çš„æ•°æ®

```js
msgHandler(e) {
  console.log('ç½‘é¡µå›æ¥çš„æ•°æ® gzhOpenId', e.detail.data) //æˆ‘æ˜¯ç½‘é¡µï¼Œè·å–åˆ°æ¥è‡ªé¡µé¢çš„æ•°æ®
  if (e.detail.data[0].gzhOpenId) {
    console.log('æœ‰ gzhOpenId', e.detail.data[0].gzhOpenId)
    wx.setStorageSync('gzhOpenId', e.detail.data[0].gzhOpenId)
  }
},
```

:::tip
ç½‘é¡µå‘å°ç¨‹åº **postMessage** æ—¶ï¼Œä¼šåœ¨ **ç‰¹å®šæ—¶æœº**ï¼ˆå°ç¨‹åºåé€€ã€ç»„ä»¶é”€æ¯ã€åˆ†äº«ï¼‰è§¦å‘å¹¶æ”¶åˆ°æ¶ˆæ¯ã€‚å¹¶ä¸æ˜¯ä» h5 é¡µé¢ä¸€è¿”å›å°±ä¼šç«‹åˆ»æ¥æ”¶åˆ°æ•°æ® ğŸ˜£
:::

`H5` é¡µé¢ä¸­çš„å®Œæ•´ä»£ç ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title></title>
    <script src="./jweixin-1.4.0.js"></script>
  </head>
  <body></body>
  <script>
    function _GetQueryString(paraName) {
      var url = decodeURI(document.location.toString());
      var arrObj = url.split("?");
      if (arrObj.length > 1) {
        var arrPara = arrObj[1].split("&");
        var arr;
        for (var i = 0; i < arrPara.length; i++) {
          arr = arrPara[i].split("=");
          if (arr != null && arr[0] === paraName) {
            return arr[1];
          }
        }
        return "";
      } else {
        return "";
      }
    }
    // åˆ¤æ–­æ˜¯å¦åœ¨å°ç¨‹åºç¯å¢ƒ
    wx.miniProgram.getEnv(function(res) {
      console.log("åˆ¤æ–­æ˜¯å¦åœ¨å°ç¨‹åºç¯å¢ƒ");
      console.log(res.miniprogram); // true
      if (res.miniprogram === true) {
        var str = location.href;
        console.log("str", str);
        var code = _GetQueryString("code");
        var appid = _GetQueryString("appid");
        var data = JSON.stringify({
          code: code,
          appid: appid
        });
        console.log("data", data);
        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;
        xhr.open(
          "POST",
          "/basicServer/wechat/mp/getWxMpServiceByMaAppIdByBase"
        );
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("cache-control", "no-cache");
        xhr.send(data);
        xhr.onreadystatechange = function() {
          // è¿™æ­¥ä¸ºåˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦æ­£ç¡®å“åº”
          if (xhr.readyState == 4 && xhr.status == 200) {
            console.log("è¯·æ±‚è¿”å›å“åº”æˆåŠŸ");
            console.log(xhr.responseText);
            var res = JSON.parse(xhr.responseText);
            // ç¬¬ä¸€å±‚åº”è¯¥æ˜¯ data,ä¸èƒ½å†™æˆ wx.miniProgram.postMessage({openId: res.data.openId })
            // å¾€å°ç¨‹åºä¼ é€’å…¬ä¼—å· openId
            wx.miniProgram.postMessage({
              data: { gzhOpenId: res.data.openId }
            });
            // è·³è½¬å›å°ç¨‹åº
            wx.miniProgram.reLaunch({
              url: "/pages/homePage/login/index"
            });
          } else {
            console.log("è¯·æ±‚æœªè¿”å›å“åº”å¤±è´¥");
            wx.miniProgram.reLaunch({
              url: "/pages/homePage/login/index"
            });
          }
        };
      }
    });
  </script>
</html>
```

åœ¨ä¿®æ”¹ `web-view` æ˜¾ç¤ºæ¸²æŸ“çŠ¶æ€çš„æ—¶å€™ï¼Œä¸èƒ½ä½¿ç”¨ `this.setData({})` æ¥åŠ é” ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ `wx.setStorageSync()` åŠ é”ï¼Œæœ€åæ˜¯è®¾ç½®å…¨å±€å˜é‡ `app.globalData` å®ç°çš„

## å°ç¨‹åºè¿›å…¥åœºæ™¯åˆ†æ

#### å¾®ä¿¡å¼€å‘è€…å·¥å…·æ¨¡æ‹Ÿè°ƒè¯•

å…ˆé€‰æ‹©è¿›å…¥åœºæ™¯ï¼Œç„¶åå°†å‚æ•°æ”¾åœ¨ `scene=` çš„åé¢

![](https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/vue-admin/20190716225641.png)

:::warning æ³¨æ„ï¼

è¿™é‡Œè¦è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦

:::

| ç¬¦å· |          è§£é‡Š          | è½¬ä¹‰ |
| ---- | :--------------------: | ---: |
| #    | ç”¨æ¥æ ‡å¿—ç‰¹å®šçš„æ–‡æ¡£ä½ç½® |  %23 |
| %    |   å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç    |  %25 |
| &    |   åˆ†éš”ä¸åŒçš„å˜é‡å€¼å¯¹   |  %26 |
| +    |   åœ¨å˜é‡å€¼ä¸­è¡¨ç¤ºç©ºæ ¼   |  %2B |
| /    |      è¡¨ç¤ºç›®å½•è·¯å¾„      |  %2F |
| \    |      è¡¨ç¤ºç›®å½•è·¯å¾„      |  %5C |
| =    |     ç”¨æ¥è¿æ¥é”®å’Œå€¼     |  %3D |
| ?    |  è¡¨ç¤ºæŸ¥è¯¢å­—ç¬¦ä¸²çš„å¼€å§‹  |  %3F |
| ç©ºæ ¼ |          ç©ºæ ¼          |  %20 |
| .    |          å¥å·          |  %2E |
| :    |          å†’å·          |  %3A |

#### è·å–å°ç¨‹åºç ä¸­çš„å‚æ•°

```js
// scene éœ€è¦ä½¿ç”¨ decodeURIComponent æ‰èƒ½è·å–åˆ°ç”ŸæˆäºŒç»´ç æ—¶ä¼ å…¥çš„ scene
console.log(decodeURIComponent(options.scene));
```

## Page ä¼ é€’å¯¹è±¡åŠæ¥æ”¶å¤–éƒ¨å‚æ•°

1. å…ˆå°†è¦ä¼ çš„å¯¹è±¡é€šè¿‡ `JSON.stringify` è½¬ä¹‰ä¸ºå­—ç¬¦ä¸²åæ‹¼æ¥åˆ° `URL` ä¸Š

```js
const details = JSON.stringify(e.currentTarget.dataset.details);
const dataType = this.properties.dataType;

wx.navigateTo({
  url: `/pages/my/repairDetails/index?dataType=${dataType}&details=${details}`
});
```

2. åˆ°è·³è½¬çš„é¡µé¢ä¸Šæ¥æ”¶è½¬ä¹‰çš„å¯¹è±¡å˜é‡

```js
onLoad (options) {
  let details = JSON.parse(options.details)
  var stringTime = details.effectiveEndTime
  let effectiveEndTime = transformationDate(stringTime, 1)
  this.setData({
    details,
    effectiveEndTime,
    monthAmount: details.monthAmount
  })
}
```

å¦‚æœåªæ˜¯æ¥æ”¶å­—ç¬¦ä¸²çš„å‚æ•°ï¼Œåˆ™ä¸ç”¨è½¬ä¹‰ï¼š

```js
onLoad (options) {
  let id = options.id
  console.log('id', id)
}
```

## åˆ†äº«åŠŸèƒ½

æŒ‰é’®çš„ `open-type` å±æ€§å€¼è®¾ç½®ä¸º `share`ï¼Œå³å¯è§¦å‘ `onShareAppMessage` å‡½æ•°

```html
<button class="button-type" open-type="share" hover-class="none">
  åˆ†äº«ç»™å¥½å‹
</button>
```

```js
  /**
   * ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
   */
  onShareAppMessage: function(res) {
    let that = this
    if (res.from === 'button') {
      // æ¥è‡ªé¡µé¢å†…è½¬å‘æŒ‰é’®
      console.log(res.target)
    }
    return {
      title: 'é’¥åŒ™åˆ†äº«', // åˆ†äº«çš„æ ‡é¢˜åç§°
      imageUrl: that.data.qrCode, // åˆ†äº«åå‡ºç°çš„å›¾ç‰‡ï¼Œå¯ä»¥è‡ªå®šä¹‰
      path: `pages/homePage/home/index?deviceId=${that.data.key}&flag=share`
      // ç”¨æˆ·ç‚¹å‡»åˆ†äº«åè·³è½¬çš„åœ°å€åŠæºå¸¦çš„å‚æ•°
    }
  }

```

## å¼•å…¥ Echarts

```js
import * as echarts from "../../../components/ec-canvas/echarts"; // å¼•å…¥

let carChart = null;
// åˆå§‹åŒ–æŸ±çŠ¶å›¾
function initCarChart(canvas, width, height) {
  carChart = echarts.init(canvas, null, {
    width: width,
    height: height
  });
  canvas.setChart(carChart);

  var option = {
    color: ["#03be3b", "#fb6c0d"],
    legend: {},
    tooltip: {},
    dataset: {
      source: [["product", "å…¥å£", "å‡ºå£"]]
    },
    xAxis: { type: "category" },
    yAxis: {},
    series: [{ type: "bar" }, { type: "bar" }]
  };

  carChart.setOption(option);
  return carChart;
}

Page({
  data: {
    ec: {
      onInit: initCarChart
    }
  },

  // æ ¹æ®å®˜æ–¹ç¤ºä¾‹æ¥è·å– Echarts å®ä¾‹
  onReady() {
    let _self = this;
    _self._fetchInoutList();
    setTimeout(function() {
      // è·å– chart å®ä¾‹çš„æ–¹å¼
      _self._vehicleLineData();
    }, 2000);
  },

  _vehicleLineData() {
    var option = {
      color: ["#03be3b", "#fb6c0d"],
      legend: {},
      tooltip: {},
      dataset: {
        source: [["product", "å…¥å£", "å‡ºå£"]]
      },
      xAxis: { type: "category" },
      yAxis: {},
      // Declare several bar series, each will be mapped
      // to a column of dataset.source by default.
      series: [{ type: "bar" }, { type: "bar" }]
    };

    carModel.vehicleLineData(this.data.dateType).then(res => {
      if (res.code === 200) {
        let { inCntTotal, outCntTotal, data, showDate } = res;
        data.forEach(e => {
          let arr = [];
          arr.push(e.date);
          arr.push(e.inCount);
          arr.push(e.outCount);
          option.dataset.source.push(arr);
        });

        // è°ƒç”¨ Echarts çš„ setOption æ–¹æ³•è¿›è¡Œæ•°æ®æ¸²æŸ“
        carChart.setOption(option);
        this.setData({
          inCntTotal,
          outCntTotal,
          showDate
        });
      }
    });
  }
});
```

## ä¸Šæ‹‰åŠ è½½æ€§èƒ½ä¼˜åŒ–

```js
Page({
  data: {
    listData: []
  },
  onReachBottom() {
    // ä¸Šæ‹‰åŠ è½½
    // é€šè¿‡é•¿åº¦è·å–ä¸‹ä¸€æ¬¡æ¸²æŸ“çš„ç´¢å¼•
    let index = this.data.listData.length;
    let newData = {}; // æ–°å˜æ›´æ•°æ®
    Api.getNews().forEach(item => {
      newData["listData[" + index++ + "]"] = item; // èµ‹å€¼ï¼Œç´¢å¼•é€’å¢
    });
    this.setData(newData); // å¢é‡æ•°æ®ï¼Œå‘é€æ•°æ®åˆ°è§†å›¾å±‚
  }
});
```

## ä½¿ç”¨ svg

å°ç¨‹åºç›®å‰æ˜¯æ— æ³•ä½¿ç”¨ svg æ ‡ç­¾çš„

å…ˆåˆ°ä¸‹é¢çš„ç½‘é¡µä¸Šç²¾ç®€ä¸€ä¸‹ svgï¼Œåˆ é™¤æ— ç”¨ä¿¡æ¯

https://jakearchibald.github.io/svgomg/

å°† SVG è½¬åŒ–æˆ Base64
æ‰“å¼€ç½‘ç«™ Â https://www.sojson.com/image2base64.htmlÂ  æ¥è½¬ Base64
æ¥ç€åœ¨ WXSS æˆ– WXML ä¸­ä½¿ç”¨

```html
<img src="data:image/jpg;base64,/9j/4QMZR..." />
```

```css
// Base64 åœ¨ CSS ä¸­çš„ä½¿ç”¨
.box {
  background-image: url("åˆšåˆšè½¬çš„ Base64");
}
```

![](https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/nginx/20190718220806.png)

ä¸è¿‡ä½¿ç”¨ base64 ä¼šä½¿å¾—ä½“ç§¯å¢å¤§ï¼Œè€Œä¸”è¿™ç§æ–¹å¼ä¹Ÿç›¸å¯¹éº»çƒ¦ä¸€ç‚¹ï¼Œå¦‚æœå›¾ç‰‡æ¯”è¾ƒå°‘å¯ä»¥å¼„ï¼Œå¤šçš„è¯å°±æ¯”è¾ƒç´¯ï¼Œå¦‚æœå›¾ç‰‡è¿˜ç»å¸¸ä¿®æ”¹å˜åŠ¨çš„è¯ï¼Œè¿˜æ˜¯ç›´æ¥ä½¿ç”¨ png å§

## ä½¿ç”¨æ¨¡ç‰ˆ

![](https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/nginx/20190718221029.png)
